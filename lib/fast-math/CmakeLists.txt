cmake_minimum_required(VERSION 3.21 FATAL_ERROR)
project(fmath_library VERSION 1.0.0 LANGUAGES C)

if(CMAKE_SYSTEM_NAME STREQUAL "Android")
    # Android-specific settings
    add_library(fmath_library SHARED kthindex.c fmath.c)
    set_target_properties(fmath_library PROPERTIES
        OUTPUT_NAME "fmath"
    )
    
    # Set properties for Android target HERE
    target_compile_definitions(fmath_library
        PRIVATE
            MATH_PREFIX=fmath_
            MATH_DEFINITION=1
    )
    
else()
    # Windows/Linux/macOS settings
    add_library(fmath_library SHARED kthindex.c fmath.c fmath.def)
    set_target_properties(fmath_library PROPERTIES
        PUBLIC_HEADER fmath.h
        VERSION ${PROJECT_VERSION}
        SOVERSION 1
        OUTPUT_NAME "fmath"
        XCODE_ATTRIBUTE_CODE_SIGN_IDENTITY "Hex_Identity_ID_Goes_Here"
    )
    
    # Set properties for desktop targets HERE
    target_compile_definitions(fmath_library
        PRIVATE
            MATH_PREFIX=fmath_
            MATH_DEFINITION=1
    )
    
    # Platform-specific optimization flags
    if(MSVC)
        # Release configuration flags
        target_compile_options(fmath_library 
            PRIVATE 
                "$<$<CONFIG:Release>:/O2>"
                "$<$<CONFIG:Release>:/GL>"
        )
        target_link_options(fmath_library 
            PRIVATE 
                "$<$<CONFIG:Release>:/LTCG>"
        )
        
        # Debug configuration flags (no optimization, with debug info)
        target_compile_options(fmath_library 
            PRIVATE 
                "$<$<CONFIG:Debug>:/Od>"
                "$<$<CONFIG:Debug>:/Zi>"
                "$<$<CONFIG:Debug>:/RTC1>"
        )
    else()
        # GCC/Clang flags
        target_compile_options(fmath_library PRIVATE -O3)
        # For release builds specifically
        set(CMAKE_C_FLAGS_RELEASE "-O3")
    endif()
endif()